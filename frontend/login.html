<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — Global Travel Insights</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(180deg,#021029 0%, #032c3b 100%); color:#e6eef8; }
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.04); }
    .neon-btn { background: linear-gradient(90deg,#06b6d4,#0ea5e9); color:white; }
    .error { color:#ff8989; }
  </style>
</head>
<body>

<div class="min-h-screen grid lg:grid-cols-2">

  <!-- Left side globe -->
  <div class="relative hidden lg:flex items-center justify-center p-12">
    <div class="w-[520px] h-[520px] glass rounded-full flex items-center justify-center shadow-xl" data-aos="zoom-in">
      <svg viewBox="0 0 200 200" class="w-4/5 h-4/5">
        <defs>
          <radialGradient id="gl" cx="30%" cy="20%">
            <stop offset="0%" stop-color="#14b8a6" stop-opacity="0.12"/>
            <stop offset="70%" stop-color="#075985" stop-opacity="0.16"/>
          </radialGradient>
        </defs>
        <circle cx="100" cy="100" r="96" fill="url(#gl)"/>
      </svg>
    </div>
  </div>

  <!-- Right side card -->
  <div class="flex items-center justify-center p-8">
    <div class="w-full max-w-md glass rounded-2xl p-8 shadow-lg" data-aos="fade-left">

      <h2 class="text-2xl font-extrabold text-white mb-2">Welcome back</h2>
      <p class="text-sm text-slate-300 mb-6">Sign in to access dashboards, insights and the AI assistant.</p>

      <form id="loginForm" class="space-y-4" novalidate>
        <div>
          <label class="text-xs text-slate-300">Email</label>
          <input id="email" type="email" required class="w-full mt-1 px-3 py-2 rounded bg-white/10 text-white placeholder:text-slate-400" placeholder="you@example.com" />
        </div>

        <div>
          <label class="text-xs text-slate-300">Password</label>
          <input id="password" type="password" required class="w-full mt-1 px-3 py-2 rounded bg-white/10 text-white" placeholder="••••••••" />
        </div>

        <div id="loginError" class="error text-sm hidden"></div>

        <button type="submit" class="neon-btn w-full py-2 rounded-lg font-semibold shadow">Login</button>

        <p class="text-center mt-3 text-sm text-slate-300">
          Don’t have an account?
          <a href="register.html" class="underline">Create one</a>
        </p>
      </form>

      <p class="mt-6 text-xs text-slate-400">This page uses backend API: <code>POST http://127.0.0.1:8000/login</code></p>

    </div>
  </div>

</div>

<script>
  AOS.init({ duration:700 });

  const API = "http://127.0.0.1:8000";

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim().toLowerCase();
    const password = document.getElementById("password").value;
    const errorBox = document.getElementById("loginError");

    errorBox.classList.add("hidden");
    errorBox.textContent = "";

    if (!email || !password) {
      errorBox.textContent = "Please enter both email and password.";
      errorBox.classList.remove("hidden");
      return;
    }

    if (!emailRegex.test(email)) {
      errorBox.textContent = "Enter a valid email.";
      errorBox.classList.remove("hidden");
      return;
    }

    try {
      const r = await fetch(`${API}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await r.json();

      if (!r.ok) {
        errorBox.textContent = data.detail || data.message || "Login failed.";
        errorBox.classList.remove("hidden");
        return;
      }

      // Login success — store token + user details
      localStorage.setItem("loggedIn", "true");
      localStorage.setItem("token", data.token);
      localStorage.setItem("gti_current_user", JSON.stringify({
        email: email,
        username: data.username
      }));

      window.location.href = "profile.html";

    } catch (err) {
      console.error(err);
      errorBox.textContent = "Server unreachable. Start backend.";
      errorBox.classList.remove("hidden");
    }
  });
</script>

</body>
</html>
